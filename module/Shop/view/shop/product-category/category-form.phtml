<?php
$form = $this->form;
$routeArray = ['action' => $this->formAction];
if (isset($this->productCategoryId)) $routeArray['id'] = $this->productCategoryId;
?>
<div class="row">
	<form class="form-horizontal col-md-12" method="post" action="<?=$this->url('admin/shop/category/edit', $routeArray) ?>">
		<fieldset>
			<legend><?=ucwords($this->formAction); ?> Product Category</legend>
			
			<div class="row">
				<div class="col-md-6">
				    <div class="row">
    				    <div class="col-md-6 text-right">
    				        <label>
    				            <?=$this->FormCheckbox($form->get('enabled'));?>
    				        </label>
    				    </div>
    				    <div class="col-md-6 text-right">
    				        <label>
    				            <?=$this->FormCheckbox($form->get('discontinued'));?>
    				        </label>
    				    </div>
				    </div>
				    
				    <div class="clearfix">&nbsp;</div>
				    
				    <div class="form-group<?php if ($form->get('category')->getMessages()) echo ' has-error'; ?>">
                        <label class="col-md-4 control-label" for="category"><?=$form->get('category')->getLabel();?></label>
                        <div class="col-md-8">
                            <?=$this->formText($form->get('category')->setAttribute('class', 'form-control')); ?>
                            <span class="help-block">
                                <?=$this->formElementErrors($form->get('category'), [
                                    'class' => 'list-unstyled'
                                ]); ?>
                            </span>
                        </div>
                    </div>
                    
                    <div class="form-group<?php if ($form->get('ident')->getMessages()) echo ' has-error'; ?>">
                        <label class="col-md-4 control-label" for="ident"><?=$form->get('ident')->getLabel();?></label>
                        <div class="col-md-8">
                            <?=$this->formText($form->get('ident')->setAttribute('class', 'form-control')); ?>
                            <span class="help-block">
                                <?=$this->formElementErrors($form->get('ident'), [
                                    'class' => 'list-unstyled'
                                ]); ?>
                            </span>
                        </div>
                    </div>
                    
                    <div class="form-group<?php if ($form->get('image')->getMessages()) echo ' has-error'; ?>">
                        <label class="col-md-4 control-label" for="image"><?=$form->get('image')->getLabel();?></label>
                        <div class="col-md-8">
                            <div class="input-group">
                                <?=$this->formText($form->get('image')->setAttribute('class', 'form-control')); ?>
                                <span class="input-group-btn">
                                    <a id="upload-category-image-button" class="btn btn-default" data-toggle="modal"
                                       data-target="#upload-category-image-model">
                                        <i class="fa fa-upload"></i>
                                    </a>
                                    <a id="list-category-image-button" class="btn btn-default" data-toggle="modal"
                                       data-target="#list-category-image-model">
                                        <i class="fa fa-list"></i>
                                    </a>
                                </span>
                            </div>
                            <span class="help-block">
                                <?=$this->formElementErrors($form->get('image'), [
                                    'class' => 'list-unstyled'
                                ]); ?>
                            </span>
                        </div>
                        <div class="col-md-12 col-md-offset-4">
                            <label>
                                <?=$this->FormCheckbox($form->get('showImage'));?>
                            </label>
                        </div>
                    </div>
                    
				</div>
				
				<div class="col-md-6">
				
				    <div class="form-group<?php if ($form->get('parent')->getMessages()) echo ' has-error'; ?>">
                        <label class="col-md-4 control-label" for="parent"><?=$form->get('parent')->getLabel();?></label>
                        <div class="col-md-8">
                            <?=$this->formSelect($form->get('parent')->setAttribute('class', 'form-control')); ?>
                            <span class="help-block">
                                <?=$this->formElementErrors($form->get('parent'), [
                                    'class' => 'list-unstyled'
                                ]); ?>
                            </span>
                        </div>
                    </div>
                    
                    
                    <div class="col-md-8 col-md-offset-4">
                        <?=$this->formRadio($this->form->get('categoryInsertType'));?>
                    </div>
                    
				</div>
			</div>
			
			<?=$this->formHidden($form->get('productCategoryId'));?>
			<input type="hidden" name="action" value="<?=$this->formAction;?>">
			
			<div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <button type="submit" class="btn btn-primary" data-loading-text="Please wait...">
                    	Submit
                    </button>
                    <button type="button" class="btn btn-warning"  data-loading-text="Please wait..." onClick="window.location = '<?=$this->url('admin/shop/category') ?>';">
                    	Cancel
                    </button>
                </div>
            </div>
		</fieldset>
	</form>
</div>

<div id="upload-category-image-model" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Upload Image</h4>
            </div>
            <div class="modal-body">
                <i class="fa fa-spinner fa-spin"></i>&nbsp;Loading
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="list-category-image-model" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Category Image</h4>
            </div>
            <div class="modal-body">
                 
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button id="list-category-image-save" type="button" class="btn btn-primary">Use Image</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    $('#upload-category-image-model').on('show.bs.modal', function () {
        $(this).find('.modal-body').load('<?=$this->url('admin/uploader', [
            'action'    => 'upload-form',
        ]);?>');
    });

    $('#upload-category-image-model').on('hide.bs.modal', function (e) {
        $(this).find('.modal-body').html('<i class="fa fa-spinner fa-spin"></i>&nbsp;Loading');

        if (admin.upload && admin.upload.status) {
            $('#product-category-image').val(admin.upload.image.name);
        }
    });

    $('#list-category-image-save').on('click', function () {
        $('#product-category-image').val(
            $('select[name=product-category-image-list]').val()
        );
        $('#list-category-image-model').modal('hide');
    });
</script>
